<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The VM core and retrieval interaction | VSAVM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/site.css">
  </head>
  <body>
    <div class="site">
      <header class="header">
        <div class="brand">VSAVM</div>
        <nav class="nav">
          <a href="../index.html">Home</a>
          <a href="../specs/">Specs</a>
          <a href="../theory/index.html">Theory</a>
          <a href="../wiki/index.html">Wiki</a>
        </nav>
      </header>
      <main class="main content">
        <h1>The VM core and retrieval interaction</h1>
<p>This page is a theory note. It expands the topic in short chapters and defines terminology without duplicating the formal specification documents.</p><p>The diagram has a transparent background and is intended to be read together with the caption and the sections below.</p>
<p>Related wiki pages: <a href="../wiki/vm.html">VM</a>, <a href="../wiki/event-stream.html">event stream</a>, <a href="../wiki/vsa.html">VSA</a>, <a href="../wiki/bounded-closure.html">bounded closure</a>, <a href="../wiki/consistency-contract.html">consistency contract</a>, <a href="../wiki/macro-program.html">macro-program</a>.</p>
<p>Related specs: <a href="../specs-viewer.html?doc=specs/DS001-foundations-and-architecture.md">DS001</a>, <a href="../specs-viewer.html?doc=specs/DS002-vm-design-execution.md">DS002</a>.</p>

<h2>Overview</h2>
<p>The VM is the system's semantic core. It stores facts, rules, contexts, and traces and executes programs to construct state. Retrieval exists to reduce search cost by proposing candidates, but it does not decide what is true. The VM presents a conversational interface that mirrors large language models while operating on fundamentally different principles: explicit programs within a virtual machine rather than latent numerical states distributed across parameters.</p>

<h2>VM state and memory model</h2>
<p>The virtual machine maintains its complete operational state through four interconnected memory structures:</p>
<ul>
  <li><strong>Canonical fact store</strong>: Primary repository for all knowledge, using normalized representation with unique canonical identifiers. Facts are organized with typed slots (subject, predicate, object, temporal qualifiers, certainty levels, source attribution) and support multiple access patterns through primary, secondary, temporal, and source indices.</li>
  <li><strong>Rule and macro-program memory</strong>: Contains executable knowledge in compiled form. Rules follow conditional structure with premises, conclusions, and constraints. Macro-programs represent consolidated reasoning patterns that accept parameters and maintain local state.</li>
  <li><strong>Binding environment</strong>: Manages temporary variables and intermediate results during execution via a stack-based system with lexical scoping and type checking.</li>
  <li><strong>Execution log</strong>: Complete trace of all operations for debugging, explanation, auditing, and rollback capabilities.</li>
</ul>

<h2>Instruction set architecture</h2>
<p>A small, typed instruction set reduces absurd combinations and branching blow-ups. The key instruction categories are:</p>
<ul>
  <li><strong>Term construction</strong>: MAKE_TERM, CANONICALIZE, BIND_SLOTS for creating symbolic structures with strict type discipline.</li>
  <li><strong>Fact manipulation</strong>: ASSERT (with consistency checks), DENY (context-sensitive negation), QUERY (pattern-based search with variable bindings).</li>
  <li><strong>Logical reasoning</strong>: MATCH (unification), APPLY_RULE, CLOSURE (bounded transitive closure).</li>
  <li><strong>Control flow</strong>: BRANCH (deterministic or exploratory), CALL (sync/async invocation), RETURN.</li>
  <li><strong>Context management</strong>: PUSH_CONTEXT, POP_CONTEXT, MERGE_CONTEXT, ISOLATE_CONTEXT for maintaining multiple consistent theories.</li>
</ul>

<h2>Execution modes</h2>
<p>The VM operates in two primary modes:</p>
<ul>
  <li><strong>Interpretation mode</strong>: Handles conversion of external input into internal symbolic representations. Coordinates event stream parsing, term construction, entity resolution, relationship extraction, and assertion processing.</li>
  <li><strong>Reasoning mode</strong>: Performs logical inference and consistency checking through cycles of rule application and conflict detection. Uses both syntactic matching and VSA semantic similarity for rule selection.</li>
</ul>
<p>State transitions are deterministic, enabling both forward execution and backward analysis for explanation generation.</p>

<h2>Macro-instruction system</h2>
<p>The macro-instruction system bridges primitive symbolic operations and complex reasoning patterns:</p>
<ul>
  <li><strong>Consolidation</strong>: Recurring instruction patterns are identified through execution log analysis, evaluated for frequency, compression benefit, and generalizability.</li>
  <li><strong>Parameter abstraction</strong>: Essential structure is preserved while incidental details are parameterized for reuse across contexts.</li>
  <li><strong>Execution optimization</strong>: Precompiled forms with dead code elimination, common subexpression elimination, and instruction reordering.</li>
  <li><strong>Schema-to-program compilation</strong>: Linguistic patterns map to macro-instructions, enabling immediate invocation when similar patterns are encountered.</li>
</ul>

<h2>How retrieval interacts</h2>
<p>VSA provides similarity-driven shortlists of schemas and macro programs. These shortlists are inputs to search and compilation, not outputs of truth. Every retrieved candidate must be validated by execution and closure to preserve the correctness contract under noise and paraphrase variation. Hypervectors enable rapid approximate nearest neighbor search; the VM then validates through precise symbolic matching.</p>

<h2>Unified event stream representation</h2>
<p>All input modalities converge into a canonical event stream with three essential components per event:</p>
<ul>
  <li><strong>Type identifier</strong>: text_token, visual_element, temporal_marker, structural_separator, etc.</li>
  <li><strong>Discrete payload</strong>: Standardized data format for VM processing.</li>
  <li><strong>Structural context path</strong>: Hierarchical positioning (document, chapter, section, paragraph, sentence, span).</li>
</ul>
<p>Reversibility is fundamental: every event must be expandable back to its constituents for source tracing and verification.</p>

<h2>Engineering benefits</h2>
<p>The explicit VM core makes it possible to unit test rules, regression test closure behavior, and audit decisions. Retrieval can be swapped or improved without changing semantics, because semantics are enforced by the VM and contract rather than by similarity ranking. Memory management uses reference counting, garbage collection, and caching with locality optimization for related facts and rules.</p>
<figure class="diagram">
<svg viewBox="0 0 900 420" role="img" aria-label="VM architecture diagram">
  <defs>
    <linearGradient id="sky" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#e8f3ff"/>
      <stop offset="1" stop-color="#d6f5e8"/>
    </linearGradient>
    <linearGradient id="deep" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#0b6eff"/>
      <stop offset="1" stop-color="#16b879"/>
    </linearGradient>
  </defs>
  <rect x="90" y="55" width="540" height="290" rx="26" ry="26" fill="none" stroke="#0b6eff" stroke-width="3"/>
<text x="120" y="85" text-anchor="start" font-size="13" fill="#2f4a63" font-family="Space Grotesk">VM core</text>
<rect x="130" y="105" rx="18" ry="18" width="210" height="60" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="235.0" y="139.0" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">Fact store</text>
<rect x="360" y="105" rx="18" ry="18" width="210" height="60" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="465.0" y="139.0" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">Rule memory</text>
<rect x="130" y="180" rx="18" ry="18" width="210" height="60" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="235.0" y="214.0" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">Context stack</text>
<rect x="360" y="180" rx="18" ry="18" width="210" height="60" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="465.0" y="214.0" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">Execution log</text>
<rect x="130" y="255" rx="18" ry="18" width="210" height="60" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="235.0" y="289.0" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">Binding environment</text>
<rect x="360" y="255" rx="18" ry="18" width="210" height="60" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="465.0" y="289.0" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">Macro-programs</text>
<rect x="670" y="85" width="160" height="260" rx="26" ry="26" fill="none" stroke="#16b879" stroke-width="3"/>
<text x="690" y="115" text-anchor="start" font-size="13" fill="#2f4a63" font-family="Space Grotesk">Retrieval</text>
<rect x="690" y="130" rx="18" ry="18" width="120" height="55" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="750.0" y="161.5" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">VSA</text>
<rect x="690" y="195" rx="18" ry="18" width="120" height="55" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="750.0" y="226.5" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">Top-K</text>
<rect x="690" y="260" rx="18" ry="18" width="120" height="55" fill="url(#sky)" stroke="#7fb3e6" stroke-width="2"/>
<text x="750.0" y="291.5" text-anchor="middle" font-size="13" fill="#0b1a2b" font-family="Space Grotesk">Schema index</text>
<line x1="630" y1="200" x2="670" y2="200" stroke="url(#deep)" stroke-width="4" stroke-linecap="round"/>
<polygon points="660,193 660,207 680,200" fill="#16b879"/>
<rect x="90" y="355" width="420" height="78" rx="16" ry="16" fill="none" stroke="#7fb3e6" stroke-width="2"/>
<text x="106" y="377" text-anchor="start" font-size="12" fill="#2f4a63" font-family="Space Grotesk">Legend</text>
<text x="106" y="399" text-anchor="start" font-size="12" fill="#2f4a63" font-family="Space Grotesk">VM is the authority via execution. Retrieval proposes; VM validates.</text>
<text x="106" y="417" text-anchor="start" font-size="12" fill="#2f4a63" font-family="Space Grotesk">Logs enable audit. Macro-programs consolidate recurring patterns.</text>
</svg>
<figcaption>A compact VM core remains the authority; retrieval accelerates candidate selection without changing semantics. The four memory structures maintain complete operational state.</figcaption>
</figure>
<h2>References</h2>
<p><a href="https://en.wikipedia.org/wiki/Symbolic_execution">Symbolic execution (Wikipedia)</a> <a href="https://en.wikipedia.org/wiki/Vector_symbolic_architecture">Vector symbolic architecture (Wikipedia)</a> <a href="https://en.wikipedia.org/wiki/Trace_(software)">Execution trace (Wikipedia)</a> <a href="https://en.wikipedia.org/wiki/Virtual_machine">Virtual machine (Wikipedia)</a></p>
      </main>
      <footer class="footer">
        VSAVM is an Axiologic Research experiment within the Achilles project. This static documentation is written in clear academic English for engineers.
      </footer>
    </div>
  </body>
</html>
